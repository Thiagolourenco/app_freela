webpackJsonp([48],{1102:function(t,e,n){t.exports={"widget-tags-editor":Promise.all([n.e(0),n.e(48)]).then(n.bind(null,4331)),"widget-tags-pickerFormElement":Promise.all([n.e(0),n.e(48)]).then(n.bind(null,4333)),"widget-tags-addIcon":Promise.all([n.e(0),n.e(48)]).then(n.bind(null,4329)),"widget-tags-list":Promise.all([n.e(0),n.e(48)]).then(n.bind(null,1705)),"widget-tags-list-standalone":Promise.all([n.e(0),n.e(48)]).then(n.bind(null,4332)),"widget-tags-special":Promise.all([n.e(0),n.e(48)]).then(n.bind(null,4335))}},1705:function(t,e,n){(function(i){var s,a,o=function(t,e){return function(){return t.apply(e,arguments)}};s=[n(3210),n(3209)],void 0!==(a=function(t,e){var n;return n=function(){function t(t){var n,i,s,a,r,p,d,c,l,u,h,g,m;null==t&&(t={}),this.dispose=o(this.dispose,this),this.addNewTag=o(this.addNewTag,this),this.initQuickEdit=o(this.initQuickEdit,this),this.isSpecial=o(this.isSpecial,this),this.OnTagsChanged=o(this.OnTagsChanged,this),this.OnClickDeleteTag=o(this.OnClickDeleteTag,this),this.OnMouseOverTag=o(this.OnMouseOverTag,this),this.OnClickTag=o(this.OnClickTag,this),this.type=t.type,this.item=t.item,this.canEdit=t.canEdit,this.limit=t.limit,this.componentName="WidgetTagsList",this.overflowTagsContent=e,this.specialTagNames=this.specialTagNames.map(function(t){return t.toLowerCase()}),this.id=null!=(n=t.id)?n:this.item.id,this.canAddTags=null!=(i=t.canAddTags)&&i,this.mode=null!=(p=t.mode)?p:void 0,this.isTipped=null!=(d=t.isTipped)&&d,this.showNoTagsMessage=null!=(c=t.showNoTagsMessage)&&c,this.showQuickEdit=ko.observable(!1),this.excludeSpecial=null!=(l=t.excludeSpecial)&&l,this.enabled=app.account.tagsEnabled,this.subscriptions=[],this.uniqueId="widgetTagsList-"+(new Date).getTime(),this.projectId=ko.unwrap(null!=(u=t.projectId)?u:0),this.autosave=null==(h=t.autosave)||h,this.showAddIcon=null==(g=t.showAddIcon)||g,this.showAddText=null==(m=t.showAddText)||m,this.tagsOnProjectGrid=null!=(s=t.tagsOnProjectGrid)&&s,app.account.tagsLockedToAdmins()&&!app.loggedInUser.permissions.administrator()&&(this.canAddTags=!1),"editing"===this.mode&&this.subscriptions.push(ko.postbox.subscribe("tagsChanged",this.OnTagsChanged)),this.canAddTags&&this.subscriptions.push(ko.postbox.subscribe("allTWEvents",this.OnNotifyTWEvent.bind(this))),this.subscriptions.push(this.limitedTags=ko.pureComputed(function(t){return function(){return t.limit?t.item.tags.slice(0,t.limit):t.item.tags}}(this))),this.subscriptions.push(this.moreTags=ko.pureComputed(function(t){return function(){return!t.limit||t.item.tags().length<=t.limit?[]:t.item.tags().slice(t.limit)}}(this))),(this.isItemNew()||"editing"===this.mode)&&(this.tagsAsList=ko.pureComputed(function(t){return function(){var e,n,i,s,a;for(a=[],i=t.item.tags(),e=0,n=i.length;e<n;e++)s=i[e],a.push(s.name());return a.toString()}}(this)),this.subscriptions.push(this.tagsAsList)),this.tagsOnSideBar=null!=(a=t.onSideBar)&&a,this.showNoProjectTagMessage=null==(r=t.showNoProjectTagMessage)||r,this.project=ko.observable(null),this.subscriptions.push(this.canEditTags=ko.pureComputed(function(t){return function(){return null==ko.unwrap(t.project())?t.canEdit:t.canEdit&&ko.unwrap(t.project()).isActive()||"tasklists-template"===ko.unwrap(t.project()).type()}}(this))),null!=this.item.projectId&&0!==ko.unwrap(this.item.projectId)&&this.project(app.projectInfo.get(this.item.projectId))}return t.prototype.tagColors=["#d84640","#f78234","#f4bd38","#b1da34","#53c944","#37ced0","#2f8de4","#9b7cdb","#f47fbe","#a6a6a6","#4d4d4d","#9e6957"],t.prototype.specialTagNames=["hubspot"],t.prototype.isItemNew=function(){return!(null!=this.item.id&&ko.unwrap(this.item.id)>0)},t.prototype.OnClickTag=function(t,e){if(this.canAddTags)return this.showQuickEdit(!1),!this.canEditTags()||(e.shiftKey?this.initQuickEdit(e.currentTarget,"replace"):(this.initQuickEdit(e.currentTarget,"edit"),!1))},t.prototype.OnMouseOverTag=function(t,e){var n;n=e.target,n.scrollWidth===n.offsetWidth&&n.removeAttribute("title")},t.prototype.OnClickDeleteTag=function(t,e){var n,i;if(e.stopPropagation(),!e.shiftKey)return this.showQuickEdit(!1),i=this.item.tags.indexOf(t),this.item.tags.splice(i,1),n=app.tags.getTagIds(this.item.tags()),this.addNewTag(n,!0),ko.postbox.publish("tagRemoved",t),this.item.tags.remove(t),!1},t.prototype.OnTagsChanged=function(t){var e,n,i,s;if(null!=t)if(s=this.item.tags(),e=t.tag,"added"===t.status){if(n=s.map(function(t){return t.id()}),n.indexOf(e.id())>-1)return;s.push(e),this.isItemNew()&&s.sort(function(t,e){return t.name()>e.name()?1:-1}),this.item.tags(s),this.addNewTag(e.id(),!1)}else this.item.tags.remove(function(t){return t.id()===e.id()}),i=app.tags.getTagIds(this.item.tags()),this.addNewTag(i,!0)},t.prototype.OnNotifyTWEvent=function(t){var e,n,i,s,a,o,r,p,d;if(r=null!=(i=t.subType)?i:"","tags"===t.itemType&&t.tags){if((null!=(s=t.extraInfo)?s.widgetInstanceId:void 0)===this.uniqueId)return;t.subType===this.type&&t.itemId===this.id()&&this.item.tags(app.tags.getAll(t.tags))}if("tag"===t.itemType&&r===this.type+"-tag-updated"&&null!=t.extraInfo.tagData){for(d=t.extraInfo.tagData,a=this.item.tags(),o=[],e=0,n=a.length;e<n;e++)p=a[e],p.id()===d.id?(p.name(d.name),p.color(d.color),o.push(p.projectId(d.projectId))):o.push(void 0);return o}},t.prototype.isSpecial=function(t){return-1!==this.specialTagNames.indexOf(t.toLowerCase())},t.prototype.initQuickEdit=function(t,e){var n;return n=i(t).closest(".w-tags__tag")[0],this.selectedTagElms=ko.observableArray([n]),this.selectedTags=ko.observableArray([ko.contextFor(n).$data]),this.selectedTagsOp=e,this.showQuickEdit(!0),!1},t.prototype.getTagsAsString=function(){var t;return t=[],this.item.tags().forEach(function(e){t.push(e.name())}),t.join(",")},t.prototype.addNewTag=function(t,e){var n,i;this.autosave&&(this.isItemNew()||(i=this.type+"/"+ko.unwrap(this.id)+"/tags.json?getTags=true&replaceExistingTags="+e,n={tagIds:t},app.api.put(i,n).then(function(t){return function(e){var n,i,s,a,o,r,p,d;if("OK"===e.response.STATUS&&(a=e.response.tags,n=null!=(o=e.response.linkedCardId)?o:0,i=null!=(r=e.response.linkedColumnId)?r:0,s=null!=(p=e.response.linkedColumnName)?p:"",t.item.tags(app.tags.getAll(a)),app.ko.postbox.publish("allTWEvents",{eventTime:new Date,projectId:(null!=(d=app.currentRoute().project)?d.id():void 0)||0,itemId:t.id(),itemType:"tags",subType:t.type,extraInfo:{widgetInstanceId:t.uniqueId,data:{cardId:n,columnId:i,columnName:s}},tags:a}),"project"===t.type))return app.projectInfo.update(t.id())}}(this))))},t.prototype.dispose=function(){this.subscriptions.forEach(function(t){return t.dispose()})},t}(),{viewModel:n,template:t}}.apply(e,s))&&(t.exports=a)}).call(e,n(245))},3206:function(t,e){t.exports='\x3c!-- ko if: shouldShowIcon() || shouldShowText() --\x3e\n\n\t\x3c!-- Decide whether to show read only tipped list of tags --\x3e\n\n\t\x3c!-- ko if: tippedSourceLink() != \'\' --\x3e\n\t\t<a href="javascript:;" class="w-tags__add-tag tipped-hide {{customClass}}" data-bind="css: { showCount: showCount }, click: OnClickAddTag, attr: { \'data-tipped-options\': \'inline: \\\'\'+tippedSourceLink()+\'\\\',skin:\\\'light\\\', hideOthers: true, hideOn: false, hideAfter: 300, detach: false, padding: 0, afterHide: function(){ app.ko.postbox.publish(\\\'\'+ko.unwrap(uniqueId)+\'-widget-tipped-tags-list-hidden\\\'); }\' }, template: {afterRender: OnRendered}">\n\t\t\t\x3c!-- ko if: showIcon --\x3e\n\t\t\t\t<i class="fa fa-tag mr--small"></i>\n\t\t\t\x3c!--/ko--\x3e\n\t\t\t\x3c!-- ko if: showCount --\x3e\n\t\t\t\t<span>{{tagsCount}}</span>\n\t\t\t\x3c!-- /ko --\x3e\n\t\t\t\x3c!-- ko if: showText --\x3e\n\t\t\t\t<span>{{label}}</span>\n\t\t\t\x3c!-- /ko --\x3e\n\t\t</a>\n\n\t\t<div id="{{uniqueId}}" style="display: none">\n\t\t\t\x3c!-- ko if: showTippedTagList && !showAddTag() --\x3e\n\t\t\t\t\x3c!-- ko component: { name:"widget-tags-list", params:{ item:item, type:type, isTipped: true, canEdit: canEdit } } --\x3e\x3c!-- /ko --\x3e\n\t\t\t\x3c!-- /ko --\x3e\n\n\t\t\t\x3c!-- ko if: showAddTag() --\x3e\n\t\t\t\t\x3c!-- ko component: { name:"widget-tags-editor", params:{ autosave: autosave, target:target, item:item, id:id, type:type, projectId:projectId, isShownObserver:showAddTag, canAddTags: ko.unwrap(canAddTags), useTipped:false, allowSelectingUnlimitedNumber: allowSelectingUnlimitedNumber } } --\x3e\x3c!-- /ko --\x3e\n\t\t\t\x3c!-- /ko --\x3e\n\t\t</div>\n\t\x3c!-- /ko --\x3e\n\n\t\x3c!-- ko if: tippedSourceLink() == \'\' --\x3e\n\t\t<a href="javascript:;" class="w-tags__add-tag tipped-hide {{customClass}}" data-bind="css: { addTagSidebar: onSideBar }, click: OnClickAddTag, template: { afterRender: OnRendered }" data-tipped="Add Tag" data-tipped-options="hideOthers: true, padding: 0">\n\n\t\t\t\x3c!-- ko if: showIcon --\x3e\n\t\t\t\t<i class="fa fa-tag mr--small"></i>\n\t\t\t\x3c!--/ko--\x3e\n\t\t\t\x3c!-- ko if: showCount --\x3e\n\t\t\t\t<span>{{item.tags().length}}</span>\n\t\t\t\x3c!-- /ko --\x3e\n\t\t\t\x3c!-- ko if: showText --\x3e\n\t\t\t\t<span>{{label}}</span>\n\t\t\t\x3c!-- /ko --\x3e\n\t\t</a>\n\t\x3c!-- /ko --\x3e\n\n\n\t\x3c!-- ko if: tippedSourceLink() == \'\' && showAddTag() --\x3e\n\t\t\x3c!-- ko component: { name:"widget-tags-editor", params:{ autosave: autosave, target: target, item: item, id: id, type: type, projectId: projectId, isShownObserver: showAddTag, canAddTags: canAddTags() && enableTagCreationIfAllowed(), useTipped: true, allowSelectingUnlimitedNumber: allowSelectingUnlimitedNumber } } --\x3e\x3c!-- /ko --\x3e\n\t\x3c!-- /ko --\x3e\n\n\x3c!-- /ko --\x3e'},3208:function(t,e){t.exports='\x3c!-- ko if: enabled --\x3e\n<div class="w-tag-popup-editor" id="addEditTagPopup" style="display:none" data-bind="template: {afterRender:OnRendered}, style:{\'display\':!useTipped?\'block\':\'\'}">\n\t\x3c!-- ko if: ko.unwrap(title).length || tagMsg().length --\x3e\n\t\t<div class="w-tag-popup-editor__header">\n\t\t\t<div class="w-tag-popup-editor__title">{{ title }}</div>\n\t\t\t\x3c!-- ko if: tagMsg() !== \'\' --\x3e\n\t\t\t\t<div class="w-tag-popup-editor__message">{{ tagMsg }}</div>\n\t\t\t\x3c!-- /ko --\x3e\n\t\t</div>\n\t\x3c!-- /ko --\x3e\n\n\t\x3c!-- ko if: shouldShowTagEditor --\x3e\n\t\t<div class="w-tag-popup-editor__body" data-bind="template: {afterRender:$component.OnRenderedItem}">\n\t\t\t<div class="w-tag-popup-editor__name" data-bind="visible: isInitialLoadComplete() || !shouldShowTagsList()">\n\t\t\t\t<form id="tagEditForm" noChangeTracking data-bind="submit: OnSubmit">\n\t\t\t\t\t\x3c!-- ko component: {name: \'widget-text-input\', params:{iconClass: \'tag-regular\', value: newTagName, placeholder:placeholderText(), focusOnLoad: true, OnClear: OnClearInput, OnKeyDown: OnKeyDownTagInput }} --\x3e\x3c!-- /ko --\x3e\n\t\t\t\t</form>\n\t\t\t</div>\n\n\t\t\t\x3c!-- ko if: shouldShowTagOptions --\x3e\n\t\t\t\t<div class="w-tag-popup-editor__details" data-bind="template: {afterRender:$component.OnRenderedItem}">\n\t\t\t\t\t<div class="u-tag-indicators u-tag-indicators--popup-editor">\n\t\t\t\t\t\t\x3c!-- ko foreach: app.tags.colors --\x3e\n\t\t\t\t\t\t\t<div class="u-tag-indicators__selector">\n\t\t\t\t\t\t\t\t<button class="u-indicator u-indicator--btn" data-bind="click:$parent.OnClickColor,css:{ \'u-indicator--btn-selected\': $data === $parent.selColor() },attr:{\'data-color\': $data }"></button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\x3c!-- /ko --\x3e\n\t\t\t\t\t</div>\n\n\t\t\t\t\t\x3c!-- ko if: app.featureFlip.check(\'projecttags\') --\x3e\n\t\t\t\t\t\t\x3c!-- ko if: shouldShowProjectToggle --\x3e\n\t\t\t\t\t\t\t<div class="w-tag-popup-editor__project-toggle">\n\t\t\t\t\t\t\t\t\x3c!-- ko component: {name: \'widget-toggleSwitch\', params:{value:isNewTagProjectSpecific, label: app.tl(\'Project Specific\'), reversedOrder: true }} --\x3e\x3c!-- /ko --\x3e\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\x3c!-- ko if: shouldShowProjectPicker --\x3e\n\t\t\t\t\t\t\t\t<div class="w-tag-popup-editor__project-picker">\n\t\t\t\t\t\t\t\t\t<select data-bind="select2:{\n\t\t\t\t\t\t\t\t\t\tvalue: selectedTagProjectId,\n\t\t\t\t\t\t\t\t\t\tinitialValue: initialProject,\n\t\t\t\t\t\t\t\t\t\tendpoint: app.prefixApi(\'projects.json?dataset=basic\',\'API_PREFIX_V2\',\'API_PREFIX_V2\'),\n\t\t\t\t\t\t\t\t\t\ttextKey: \'name\',\n\t\t\t\t\t\t\t\t\t\tgroupById: \'companyId\',\n\t\t\t\t\t\t\t\t\t\tgroupByName: \'companyName\',\n\t\t\t\t\t\t\t\t\t\tminimumResultsForSearch: 10,\n\t\t\t\t\t\t\t\t\t\tplaceholder: app.tl(\'Select a Project\')+app.localizationPreferences().ellipsis\n\t\t\t\t\t\t\t\t\t}" style="width:100%"></select>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\x3c!-- /ko --\x3e\n\t\t\t\t\t\t\x3c!-- /ko --\x3e\n\n\t\t\t\t\t\t\x3c!-- ko if: shouldShowProjectCheckbox --\x3e\n\t\t\t\t\t\t\t<div class="w-tag-popup-editor__project-checkbox">\n\t\t\t\t\t\t\t\t<label data-bind="click: OnClickToggleTagLevel" class="flex flex-items-center mb--none">\n\t\t\t\t\t\t\t\t\t\x3c!-- ko component: {\n\t\t\t\t\t\t\t\t\t\t\tname: \'ui-checkbox-icon\',\n\t\t\t\t\t\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\t\t\t\t\t\tselected: isTagTopLevel\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} --\x3e\n\t\t\t\t\t\t\t\t\t\x3c!-- /ko --\x3e\n\t\t\t\t\t\t\t\t\t<span class="ml--small">{{app.tl(\'Available on all projects\')}}</span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\x3c!-- /ko --\x3e\n\t\t\t\t\t\x3c!-- /ko --\x3e\n\n\t\t\t\t\t<div class="w-tag-popup-editor__action">\n\t\t\t\t\t\t<button class="btn btn-success btn-sm width--100 ladda-button" data-bind="click:OnSubmit, ladda: isSubmitting, enable:canSubmit()" data-style="expand-right">\n\t\t\t\t\t\t\t<span class="ladda-label">{{ saveBtnText }}</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\x3c!-- /ko --\x3e\n\n\t\t\t\x3c!-- ko if: shouldShowTagsList --\x3e\n\t\t\t\t<div class="w-tag-popup-editor__list" data-bind="outsidescroll: false">\n\t\t\t\t\t\x3c!-- ko if: data.state() === \'content\' --\x3e\n\t\t\t\t\t\t\x3c!-- ko if: tagsByProject().length && shouldShowProjectTags() --\x3e\n\t\t\t\t\t\t\t\x3c!-- ko if: tagsByProject().length === 1 --\x3e\n\t\t\t\t\t\t\t\t<div class="w-tag-popup-editor__project-header">\n\t\t\t\t\t\t\t\t\t<span>{{ app.tl(\'Tags on this project\') }}</span>\n\t\t\t\t\t\t\t\t\t\x3c!-- ko component: { name:\'widget-tip\', params:{ html: tagTooltipText, maxWidth: 150 } } --\x3e\x3c!-- /ko --\x3e\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\x3c!-- /ko --\x3e\n\t\t\t\t\t\t\t\x3c!-- ko foreach: tagsByProject --\x3e\n\t\t\t\t\t\t\t\t<div class="u-tags">\n\t\t\t\t\t\t\t\t\t<ul class="list-unstyled px--small">\n\t\t\t\t\t\t\t\t\t\t\x3c!-- ko foreach: tags --\x3e\n\t\t\t\t\t\t\t\t\t\t\t<li data-bind="template: {afterRender:$component.OnRenderedItem}">\n\t\t\t\t\t\t\t\t\t\t\t\t\x3c!-- ko component: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tname:"ui-tag",\n\t\t\t\t\t\t\t\t\t\t\t\t\tparams:{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttag: $data,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisplayType: \'list\',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tOnClickTagEvent: $component.OnClickTag,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowCount: false\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t} --\x3e\x3c!-- /ko --\x3e\n\t\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t\x3c!-- /ko --\x3e\n\t\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\x3c!-- /ko --\x3e\n\t\t\t\t\t\t\x3c!-- /ko --\x3e\n\n\t\t\t\t\t\t\x3c!-- ko if: topLevelTags().length --\x3e\n\t\t\t\t\t\t\t\x3c!-- ko if: shouldShowProjectTags() --\x3e\n\t\t\t\t\t\t\t\t<div class="w-tag-popup-editor__project-header">\n\t\t\t\t\t\t\t\t\t<span>{{ app.tl(\'All Projects\') }}</span>\n\t\t\t\t\t\t\t\t\t<a href="#" class="w-tag-popup-editor__toggle-project" data-bind="click: OnClickToggleTopLevelTags, visible: tagsByProject().length">{{ topLevelToggleMsg }}</a>\n\t\t\t\t\t\t\t\t\t\x3c!-- ko ifnot: tagsByProject().length --\x3e\n\t\t\t\t\t\t\t\t\t\t\x3c!-- ko component: { name:\'widget-tip\', params:{ html: tagTooltipText, maxWidth: 150} } --\x3e\x3c!-- /ko --\x3e\n\t\t\t\t\t\t\t\t\t\x3c!-- /ko --\x3e\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\x3c!-- /ko --\x3e\n\n\t\t\t\t\t\t\t\x3c!-- ko if: isShowingTopLevelTags --\x3e\n\t\t\t\t\t\t\t\t<ul class="list-unstyled px--small">\n\t\t\t\t\t\t\t\t\t\x3c!-- ko foreach: topLevelTags --\x3e\n\t\t\t\t\t\t\t\t\t<li data-bind="template: {afterRender:$component.OnRenderedItem}">\n\t\t\t\t\t\t\t\t\t\t\t\x3c!-- ko component: {\n\t\t\t\t\t\t\t\t\t\t\t\tname:"ui-tag",\n\t\t\t\t\t\t\t\t\t\t\t\tparams:{\n\t\t\t\t\t\t\t\t\t\t\t\t\ttag: $data,\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisplayType: \'list\',\n\t\t\t\t\t\t\t\t\t\t\t\t\tOnClickTagEvent: $component.OnClickTag,\n\t\t\t\t\t\t\t\t\t\t\t\t\tshowCount: false\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t} --\x3e\x3c!-- /ko --\x3e\n\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\x3c!-- /ko --\x3e\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\x3c!-- /ko --\x3e\n\t\t\t\t\t\t\x3c!-- /ko --\x3e\n\n\t\t\t\t\t\t<div class="w-tag-popup-editor__loadmore" data-bind="visible: shouldShowLoadMoreTags">\n\t\t\t\t\t\t\t<a class="truncate" href="javascript:void(0)" data-bind="visible: data.state() === \'content\', click:OnClickLoadMore">\n\t\t\t\t\t\t\t\t{{app.tl("Load more")}}{{{app.localizationPreferences().ellipsis}}}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t<div class="tags-loader" data-bind="visible: isLoading">\n\t\t\t\t\t\t\t\t<i class="fa fa-spinner fa-spin fa-2x fa-fw"></i>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!-- /ko --\x3e\n\t\t\t\t</div>\n\t\t\t\x3c!-- /ko --\x3e\n\n\t\t\t\x3c!-- ko if: footerMsg() !== \'\' && !isLoading() --\x3e\n\t\t\t\t<div class="w-tag-popup-editor__footer">\n\t\t\t\t\t{{ footerMsg }}\n\t\t\t\t</div>\n\t\t\t\x3c!-- /ko --\x3e\n\t\t</div>\n\t\x3c!-- /ko --\x3e\n</div>\n\x3c!-- /ko --\x3e\n'},3209:function(t,e){t.exports='<div class="tagHolder tags-tipped w-tags">\n\t\x3c!-- ko foreach: $component.moreTags() --\x3e\n\t<span data-bind="click:$parent.OnClickTag,\n\t\tcss: { tagsOnSideBar: $component.tagsOnSideBar, ne:!$parent.canEdit },\n\t\tstyle:{backgroundColor:color, \'cursor\':($parent.canEditTags() ? \'pointer\' : \'\')},\n\t\tattr:{\'data-tagId\':($data.id? $data.id : null )}"\n\t\tclass="w-tags__tag tags-tipped__tag">\n\n\t\t<span data-bind="css: { tagNameSpanSideBar: $component.tagsOnSideBar }" ></span>\n\n\t\t<span class="w-tags__tag-name">{{ $data.name() }}</span>\n\n\t\t\x3c!-- ko if: $parent.canEditTags --\x3e\n\t\t\t<a href="javascript:;" data-bind="click:$parent.OnClickDeleteTag,attr:{title:app.tl(\'Remove Tag\')}" class="w-tags__tag-remove">\n\t\t\t\t<i class="fa fa-close" aria-hidden="true"></i>\n\t\t\t</a>\n\t\t\x3c!-- /ko --\x3e\n\t</span>\n\t\x3c!-- /ko --\x3e\n</div>\n'},3210:function(t,e){t.exports='\n\x3c!-- ko if: app.account.integrations.hubSpot && app.account.integrations.hubSpot.enabled && app.account.integrations.hubSpot.enabled() --\x3e\n\t\x3c!-- ko ifnot: excludeSpecial --\x3e\n\t\t\x3c!-- ko component: { name:"widget-tags-special", params:{ id: item.id, type:type, tags: item.tags } } --\x3e\x3c!-- /ko --\x3e\n\t\x3c!-- /ko --\x3e\n\x3c!-- /ko --\x3e\n\n\x3c!-- ko if: enabled() && item.tags && item.tags().length --\x3e\n\t<div class="w-tags" data-bind="css: {\'w-tags--can-add\': canAddTags, \'w-tags--sidebar\': $component.tagsOnSideBar, isTipped: $component.isTipped}">\n\n\t\t\x3c!-- ko if: showNoTagsMessage && item.tags().length == 0 --\x3e\n\t\t\t<span class="w-tags__none-message">\n\t\t\t\t{{ app.tl(\'No Tags\') }}\n\t\t\t</span>\n\t\t\x3c!-- /ko --\x3e\n\n\t\t\x3c!-- ko foreach: limitedTags() --\x3e\n\n\t\t\t\x3c!-- ko ifnot: $parent.isSpecial(name()) --\x3e\n\t\t\t\t<span class="w-tags__tag" data-bind="click: $parent.OnClickTag, style: {backgroundColor: color, \'cursor\': ($parent.canAddTags ? \'pointer\' : \'\')}, attr: {\'data-tagId\': ($data.id ? $data.id : null )}">\n\t\t\t\t\t<span class="w-tags__tag-name" data-bind="attr: { title: name }, event: { mouseover: $component.OnMouseOverTag }">\n\t\t\t\t\t\t{{ name }}\n\t\t\t\t\t</span>\n\t\t\t\t\t\x3c!-- ko if: $parent.canEditTags --\x3e\n\t\t\t\t\t\t<a href="javascript:;" class="w-tags__tag-remove" data-bind="click: $parent.OnClickDeleteTag, attr: {title: app.tl(\'Remove Tag\')}">\n\t\t\t\t\t\t\t<i class="fa fa-close" aria-hidden="true"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\x3c!-- /ko --\x3e\n\t\t\t\t</span>\n\t\t\t\x3c!-- /ko --\x3e\n\n\t\t\x3c!-- /ko --\x3e\n\t\t\x3c!-- ko if: moreTags().length --\x3e\n\t\t\t<span data-bind="tippedDelegate"\n\t\t\t\tclass="pdPointer tags-more"\n\t\t\t\tdata-tipped-options="\n\t\t\t\t\tskin:\'light\',\n\t\t\t\t\thideOthers:true,\n\t\t\t\t\thideOn: false,\n\t\t\t\t\thideAfter: 300,\n\t\t\t\t\tshowOn: \'mouseover\',\n\t\t\t\t\tposition:\'bottom\'"\n\t\t\t\tdata-content="{{$component.overflowTagsContent}}">\n\t\t\t\t<span class="w-tags__tag u-background-color--brand-blue">+{{moreTags().length}}</span>\n\t\t\t</span>\n\t\t\x3c!-- /ko --\x3e\n\t   \t\x3c!-- below is just used for the tags on the project overview sidebar --\x3e\n\t\t\x3c!-- ko if: $component.tagsOnSideBar && $component.canEditTags() && item.tags().length <= app.consts.TAGSLIMIT --\x3e\n\t\t\t\x3c!-- ko component: {\n\t\t\t\t\t\tname:"widget-tags-addIcon",\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\titem: item,\n\t\t\t\t\t\t\ttype: $component.type,\n\t\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\t\tshowText: true,\n\t\t\t\t\t\t\tshowIcon: showAddIcon,\n\t\t\t\t\t\t\tonSideBar: $component.tagsOnSideBar,\n\t\t\t\t\t\t\tprojectId: projectId\n\t\t\t\t\t\t}\n\t\t\t\t\t} --\x3e\n\t\t\t\x3c!-- /ko --\x3e\n\n\t\t\x3c!-- /ko --\x3e\n\n\t\t\x3c!-- ko if: showQuickEdit() --\x3e\n\t\t\t\x3c!-- ko component: { name:"widget-tags-editor", params:{ target:jQuery(selectedTagElms()[0])[0], mode:selectedTagsOp, item:item, type:type, isShownObserver:showQuickEdit, selectedTags:selectedTags, selectedTagElms:selectedTagElms, canAddTags: ko.unwrap(canAddTags)} } --\x3e\x3c!-- /ko --\x3e\n\t\t\x3c!-- /ko --\x3e\n\t</div>\n\x3c!-- /ko --\x3e\n\n\x3c!-- ko if: tagsOnSideBar && $component.canEditTags() && item.tags().length == 0 --\x3e\n\t<div data-bind="css: {\'tag-holder--can-add-tags\': canAddTags, \'w-tags--sidebar\': $component.tagsOnSideBar, isTipped: $component.isTipped }">\n\n\t\t\x3c!-- ko if: $component.showNoProjectTagMessage --\x3e\n\t\t\t<span class="w-tags__none-message">\n\t\t\t\t{{ app.tl(\'No Tags\') }}\n\t\t\t</span>\n\t\t\x3c!-- /ko --\x3e\n\n\t\t\x3c!-- ko component: {\n\t\t\t\t\tname:"widget-tags-addIcon",\n\t\t\t\t\tparams: {\n\t\t\t\t\t\titem: item,\n\t\t\t\t\t\ttype: $component.type,\n\t\t\t\t\t\tenabled: true,\n\t\t\t\t\t\tcanAddTags: canAddTags,\n\t\t\t\t\t\tshowText: true,\n\t\t\t\t\t\tonSideBar: true,\n\t\t\t\t\t\tprojectId: projectId\n\t\t\t\t\t}\n\t\t\t\t} --\x3e\n\t\t\x3c!-- /ko --\x3e\n\t</div>\n\x3c!-- /ko --\x3e\n'},3211:function(t,e){t.exports='\x3c!-- ko if: enabled --\x3e\n\t<div class="tag-picker-form-wrap">\n\t\t\x3c!-- ko component: { name:"widget-tags-list", params:{ item:item, canEdit:true, canAddTags: canAddTags, enabled: enabled, excludeSpecial:true} } --\x3e\x3c!-- /ko --\x3e\n\t\t\x3c!-- ko component: { name:"widget-tags-addIcon", params:{ item:item, projectId:projectId, showText:true, enableTagCreationIfAllowed: canAddTags, enabled: enabled, label: label, allowSelectingUnlimitedNumber: allowSelectingUnlimitedNumber } } --\x3e\x3c!-- /ko --\x3e\n\t\t<input type="hidden" name="tagNames" data-bind="value: tagNames()"/>\n\t\t<input type="hidden" name="tagIds" data-bind="value: tagIds()"/>\n\t</div>\n\x3c!-- /ko --\x3e\n'},3213:function(t,e){t.exports='\x3c!-- ko if: specialTagsView && specialTagsView().length --\x3e\n\t<div class="tagHolder inline mb--small" data-bind="css:{\'tag-holder--can-add-tags\': canAddTags}">\n\t\t\x3c!-- ko foreach: specialTagsView --\x3e\n\t\t\t\x3c!-- ko component: {\n\t\t\t\tname:"widget-tags-special-" + $data.tag.name().toLowerCase(),\n\t\t\t\tparams:{\n\t\t\t\t\titemType:$parent.type,\n\t\t\t\t\titem:$parent.item,\n\t\t\t\t\ttag:$data.tag,\n\t\t\t\t\tenabled: enabled,\n\t\t\t\t\tuseWhiteIcon: $parent.useWhiteIcon,\n\t\t\t\t\tonTagUpdated: $parent.load\n\t\t\t\t}\n\t\t\t} --\x3e\x3c!-- /ko --\x3e\n\t\t\x3c!-- /ko --\x3e\n\t</div>\n\x3c!-- /ko --\x3e\n'},4329:function(t,e,n){var i,s,a=function(t,e){return function(){return t.apply(e,arguments)}};i=[n(3206)],void 0!==(s=function(t){var e;return e=function(){function t(t){var e,n,i,s,o,r,p,d,c,l,u;null==t&&(t={}),this.dispose=a(this.dispose,this),this.OnRendered=a(this.OnRendered,this),this.OnClickAddTag=a(this.OnClickAddTag,this),this.subscriptions=[],this.item=t.item,this.id=null!=(e=t.id)?e:this.item.id,this.type=t.type,this.view=t.view||"",this.label=null!=(n=t.label)?n:app.tl("Add Tag"),this.canEdit=null!=(s=t.canEdit)&&s,this.onSideBar=null!=(o=t.onSideBar)&&o,this.showText=app.utility.EnsureObservable(null!=(r=t.showText)&&r),this.showTippedTagList=null!=t.showTippedTagList?t.showTippedTagList:t.showTippedTagList=!1,this.enabled=app.account.tagsEnabled,this.showIcon=null==(p=t.showIcon)||p,this.showAddTag=ko.observable(!1),this.showCount=null!=t.showCount?t.showCount:t.showCount=!1,this.enableTagCreationIfAllowed=ko.observable(ko.unwrap(null!=t.enableTagCreationIfAllowed?t.enableTagCreationIfAllowed:t.enableTagCreationIfAllowed=!0)),this.target=null!=(d=t.element)?d:null,this.autosave=null==(c=t.autosave)||c,this.projectId=app.utility.EnsureObservable(null!=(l=t.projectId)?l:0),this.customClass=null!=(u=t.customClass)&&u,this.allowSelectingUnlimitedNumber=null!=(i=t.allowSelectingUnlimitedNumber)&&i,-1===["company","user"].indexOf(this.type)||window.bDebug||(this.enabled=!1),this.subscriptions.push(this.tagsCount=ko.pureComputed(function(t){return function(){return t.item.tags().length}}(this))),this.subscriptions.push(this.uniqueId=ko.pureComputed(function(t){return function(){return null==t.item||null==t.id?"":"tippedTagList"+t.id()+"_"+(new Date).getTime()}}(this))),this.subscriptions.push(this.tippedSourceLink=ko.pureComputed(function(t){return function(){var e,n;return t.showTippedTagList&&(null!=(e=t.item)&&null!=(n=e.tags())?n.length:void 0)>0?t.uniqueId():""}}(this))),this.project=ko.observable(null),this.subscriptions.push(this.canAddTags=ko.pureComputed(function(t){return function(){return"account"===app.loggedInUser.userType()&&(!app.account.tagsLockedToAdmins()||app.loggedInUser.administrator())}}())),this.subscriptions.push(this.shouldShowIcon=ko.pureComputed(function(t){return function(){return!!ko.unwrap(t.enabled)&&(null==ko.unwrap(t.project())?t.showIcon:ko.unwrap(t.project()).isActive())}}(this))),this.subscriptions.push(this.shouldShowText=ko.pureComputed(function(t){return function(){return!!ko.unwrap(t.enabled)&&(null==ko.unwrap(t.project())?t.showText():ko.unwrap(t.project()).isActive()||"tasklists-template"===ko.unwrap(t.project()).type())}}(this))),null!=this.item.projectId&&0!==ko.unwrap(this.item.projectId)&&this.project(app.projectInfo.get(this.item.projectId)),this.subscriptions.push(app.ko.postbox.subscribe(ko.unwrap(this.uniqueId)+"-widget-tipped-tags-list-hidden",function(t){return function(){return t.showAddTag(!1)}}(this)))}return t.prototype.OnClickAddTag=function(){return this.showAddTag(!0),setTimeout(function(){return Tipped.refresh()},500),!1},t.prototype.OnRendered=function(t){return this.target=t[0].parentNode},t.prototype.dispose=function(){this.subscriptions.forEach(function(t){return t.dispose()}),this.delayedNewTagSubscription&&this.delayedNewTagSubscription.dispose()},t}(),{viewModel:e,template:t}}.apply(e,i))&&(t.exports=s)},4331:function(t,e,n){(function(i){var s,a,o=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty,p=function(t,e){return function(){return t.apply(e,arguments)}},d=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};s=[n(3208),n(1249),n(1117),n(1116)],void 0!==(a=function(t,e,n,s){var a,r;return a=function(t){function e(t){e.__super__.constructor.call(this,t),null!=this.isSelected&&ko.isObservable(this.isSelected)||(this.isSelected=ko.observable(!1))}return o(e,t),e}(e),r=function(){function t(t){var e,n,i,o,r,c,l,u,h,g,m,T,f,x;null==t&&(t={}),this.dispose=p(this.dispose,this),this.isProjectLevelTagSelected=p(this.isProjectLevelTagSelected,this),this.setFilteredTags=p(this.setFilteredTags,this),this.persistTags=p(this.persistTags,this),this.saveTagChanges=p(this.saveTagChanges,this),this.deSelectAllTags=p(this.deSelectAllTags,this),this.highlightTag=p(this.highlightTag,this),this.setUpTipped=p(this.setUpTipped,this),this.OnClickToggleTagLevel=p(this.OnClickToggleTagLevel,this),this.OnClickToggleTopLevelTags=p(this.OnClickToggleTopLevelTags,this),this.OnClickLoadMore=p(this.OnClickLoadMore,this),this.OnClickColor=p(this.OnClickColor,this),this.OnClickTag=p(this.OnClickTag,this),this.OnKeyDownTagInput=p(this.OnKeyDownTagInput,this),this.OnClearInput=p(this.OnClearInput,this),this.OnRendered=p(this.OnRendered,this),this.OnRenderedItem=p(this.OnRenderedItem,this),this.mode=null!=(n=t.mode)?n:"add",this.target=t.target,"string"==typeof this.target&&(this.target=document.getElementById(t.target)),this.item=t.item,this.type=t.type,this.id=null!=(i=t.id)?i:this.item.id,this.isShownObserver=t.isShownObserver,this.selectedTags=null!=(l=t.selectedTags)?l:ko.observableArray([]),this.canAddTags=ko.unwrap(null!=(u=t.canAddTags)&&u),this.useTipped=null==(h=t.useTipped)||h,this.autosave=null==(g=t.autosave)||g,this.createTag=null!=(m=t.createTag)?m:null!=(T=this.isItemNew())?T:{true:!1},this.subscriptions=[],this.parent=null!=(f=Tipped.get(".tags-more").tooltips[0])?f:null,this.projectId=app.utility.EnsureObservable(null!=(x=t.projectId)?x:0),this.enabled=app.account.tagsEnabled,this.selColor=ko.observable(app.tags.colors[6]),this.newTagName=ko.observable("").extend({rateLimit:{timeout:200,method:"notifyWhenChangesStop"}}),this.searchTerm=ko.observable(""),this.menuIndexPos=ko.observable(this.canAddTags?-1:0),this.filteredTags=ko.observableArray(),this.tagsByProject=ko.observableArray([]),this.userMustChooseTagOpts=ko.observable(!1),this.isShowingTopLevelTags=ko.observable(!0),this.isSubmitting=ko.observable(!1),this.topLevelItems=["project","company","user"],this.isInitialLoadComplete=ko.observable(!1),null==(e=this.item).tags&&(e.tags=ko.observableArray([])),this.allowSelectingUnlimitedNumber=null!=(o=t.allowSelectingUnlimitedNumber)&&o,console.assert("edit"!==this.mode||1===this.selectedTags().length),this.subscriptions.push(this.selectedTag=ko.pureComputed(function(t){return function(){return 1!==t.selectedTags().length?null:t.selectedTags()[0]}}(this))),this.subscriptions.push(this.selectedTagsProjectIds=ko.pureComputed(function(t){return function(){return t.selectedTags().map(function(t){return t.projectId()})}}(this))),this.subscriptions.push(this.areCrossProjectTagsSelected=ko.pureComputed(function(t){return function(){return app.utility.Uniq(t.selectedTagsProjectIds()).length>1}}(this))),this.initialTagProjectId=this.isProjectLevelTagSelected()?this.selectedTags()[0].projectId():0,this.areCrossProjectTagsSelected()&&(this.initialTagProjectId=0),this.isNewTagProjectSpecific=ko.observable(this.initialTagProjectId>0),null!=(null!=(r=this.selectedTag())?r.color:void 0)&&this.selColor(ko.unwrap(this.selectedTag().color)),null!=(null!=(c=this.selectedTag())?c.name:void 0)&&this.newTagName(ko.unwrap(this.selectedTag().name)),"replace"===this.mode&&this.newTagName(""),this.selectedTagProjectId=ko.observable(this.initialTagProjectId),this.subscriptions.push(this.initialProject=ko.pureComputed(function(t){return function(){var e,n,i;return e={id:0,text:app.tl("Please select a project")},0===t.initialTagProjectId?e:null!=(null!=(n=t.selectedTags()[0])?n.projectName:void 0)?{id:t.initialTagProjectId,text:t.selectedTags()[0].projectName()}:0===t.projectId()?e:(i=app.projectInfo.get(t.projectId()),i()?{id:i().id,text:i().name}:e)}}(this))),this.subscriptions.push(this.isInitialProjectLoaded=ko.pureComputed(function(t){return function(){return!(!t.initialProject()||null==t.initialProject().id)}}(this))),this.subscriptions.push(this.isTagTopLevel=ko.pureComputed(function(t){return function(){return!t.isNewTagProjectSpecific()}}(this))),this.subscriptions.push(this.canUseProjectTags=ko.pureComputed(function(t){return function(){var e;return!!app.featureFlip.check("projecttags",{unwrap:!0})&&(e=t.type,!(d.call(t.topLevelItems,e)>=0)&&"task-templates"!==app.currentRoute().page)}}(this))),this.subscriptions.push(this.isNewTagProjectSpecific.subscribe(function(t){return function(e){if(!e)return t.selectedTagProjectId(0);if(t.canUseProjectTags())return"add"===t.mode&&t.projectId()>0?t.selectedTagProjectId(t.projectId()):"edit"===t.mode&&t.initialTagProjectId>0?t.selectedTagProjectId(t.initialTagProjectId):void 0}}(this))),this.subscriptions.push(this.filteredTags.subscribe(function(t){return function(){return setTimeout(function(){return null!=t.tippedObj?t.tippedObj.refresh():Tipped.refresh()},100)}}(this))),this.subscriptions.push(this.topLevelTags=ko.pureComputed(function(t){return function(){var e;return(null!=(e=t.filteredTags())?e.length:void 0)?t.filteredTags().filter(function(t){return 0===parseInt(t.projectId())}):[]}}(this))),this.subscriptions.push(this.projectLevelTags=ko.pureComputed(function(t){return function(){var e;return(null!=(e=t.filteredTags())?e.length:void 0)?t.filteredTags().filter(function(t){return 0!==parseInt(t.projectId(),10)}):[]}}(this))),this.subscriptions.push(this.isNewTagAlreadyAlreadyAttached=ko.pureComputed(function(t){return function(){var e;return null!=t.item&&(e=ko.utils.arrayFilter(t.item.tags(),function(e){return e.name()===t.newTagName().toLowerCase()}),0!==e.length)}}(this))),this.subscriptions.push(this.newTagName.subscribe(function(t){return function(e){-1!==t.menuIndexPos()&&t.canAddTags||t.searchTerm(e)}}(this))),this.subscriptions.push(this.hasReachedTagNumberLimit=ko.pureComputed(function(t){return function(){if(!t.allowSelectingUnlimitedNumber)return t.item.tags().filter(function(t){return"hubspot"!==t.name().toLowerCase()}).length>=app.consts.TAGSLIMIT}}(this))),this.subscriptions.push(this.isLoading=ko.pureComputed(function(t){return function(){var e;return"loading"===(null!=(e=t.data)?e.state():void 0)}}(this))),this.subscriptions.push(this.isCreatingNewTag=ko.pureComputed(function(t){return function(){return!!t.canAddTags&&("edit"!==t.mode&&((0===t.filteredTags().length||t.userMustChooseTagOpts())&&""!==t.newTagName()&&!t.isNewTagAlreadyAlreadyAttached()&&!t.isLoading()))}}(this))),this.subscriptions.push(this.tagMustBeTopLevel=ko.pureComputed(function(t){return function(){return!("merge"!==t.mode||!t.areCrossProjectTagsSelected())}}(this))),this.subscriptions.push(this.newTagObj=ko.pureComputed(function(t){return function(){return{name:t.newTagName(),color:t.selColor(),projectId:t.selectedTagProjectId()}}}(this))),this.subscriptions.push(this.shouldShowTagOptions=ko.pureComputed(function(t){return function(){return"edit"===t.mode||t.isCreatingNewTag()}}(this))),this.subscriptions.push(this.shouldShowTagEditor=ko.pureComputed(function(t){return function(){return!("add"!==t.mode||!t.item||t.hasReachedTagNumberLimit())||!("add"===t.mode||!t.selectedTags().length)}}(this))),this.subscriptions.push(this.shouldShowTagsList=ko.pureComputed(function(t){return function(){return"edit"!==t.mode&&!t.isCreatingNewTag()}}(this))),this.subscriptions.push(this.shouldShowProjectToggle=ko.pureComputed(function(t){return function(){return!!t.shouldShowTagOptions()&&("edit"===t.mode?"settings"===t.type&&(!(t.projectId()>0)&&(!(t.initialTagProjectId>0)&&!!t.canUseProjectTags())):!!("add"===t.mode&&t.projectId()>0&&t.canUseProjectTags()))}}(this))),this.subscriptions.push(this.shouldShowProjectCheckbox=ko.pureComputed(function(t){return function(){return!!t.shouldShowTagOptions()&&(!t.shouldShowProjectToggle()&&(!t.tagMustBeTopLevel()&&("edit"===t.mode&&t.initialTagProjectId>0||!("merge"!==t.mode||!t.isProjectLevelTagSelected()))))}}(this))),this.subscriptions.push(this.shouldShowProjectPicker=ko.pureComputed(function(t){return function(){return!!t.isInitialProjectLoaded()&&(!(!t.shouldShowProjectToggle()||!t.isNewTagProjectSpecific())&&("edit"===t.mode&&0===parseInt(t.initialTagProjectId,10)))}}(this))),this.subscriptions.push(this.shouldShowProjectPicker.subscribe(function(){return setTimeout(function(t){return function(){return null!=t.tippedObj?t.tippedObj.refresh():Tipped.refresh()}}(this),10)})),this.subscriptions.push(this.shouldShowProjectTags=ko.pureComputed(function(t){return function(){return 0!==t.projectId()||!t.areCrossProjectTagsSelected()}}(this))),this.subscriptions.push(this.canSubmit=ko.pureComputed(function(t){return function(){return!t.isSubmitting()&&((!t.shouldShowProjectPicker()||0!==t.selectedTagProjectId())&&("edit"!==t.mode||""!==t.newTagName()))}}(this))),this.subscriptions.push(this.shouldShowLoadMoreTags=ko.pureComputed(function(t){return function(){return!(t.topLevelTags().length&&!t.isShowingTopLevelTags())&&(t.data.hasMoreRecords()&&(""===t.newTagName()||t.menuIndexPos()>-1))}}(this))),this.title=function(){switch(this.mode){case"edit":return app.tl("Edit Tag");case"replace":return app.tl("Replace Tag");case"merge":return app.tl("Merge Tags");default:return""}}.call(this),this.subscriptions.push(this.tagMsg=ko.pureComputed(function(t){return function(){var e;if("add"===t.mode&&null!=t.item&&t.hasReachedTagNumberLimit())return app.tl("Only [_s] tags are allowed",app.consts.TAGSLIMIT);if("merge"===t.mode&&!t.isNewTagAlreadyAlreadyAttached())return t.areCrossProjectTagsSelected()?app.tl("The merged tag will be on all projects"):app.tl("A new tag will be created");if(0===t.filteredTags().length){if("edit"!==t.mode&&!t.canAddTags&&""!==t.newTagName()&&!t.isNewTagAlreadyAlreadyAttached())return app.tl("Tag not found");if("edit"!==t.mode&&t.isNewTagAlreadyAlreadyAttached())return app.tl("This tag is already attached");if(""===t.newTagName()&&"edit"!==(e=t.mode)&&"merge"!==e)return t.isLoading()?app.tl("Loading tags")+app.localizationPreferences().ellipsis:app.tl("No tags available")}return""}}(this))),this.subscriptions.push(this.footerMsg=ko.pureComputed(function(t){return function(){return t.tagMustBeTopLevel()?app.tl("Tags from different projects can only be merged into a top level tag"):""}}(this))),this.subscriptions.push(this.topLevelToggleMsg=ko.pureComputed(function(t){return function(){return t.isShowingTopLevelTags()?app.tl("Hide"):app.tl("Show")}}(this))),this.subscriptions.push(this.tagTooltipText=ko.pureComputed(function(t){return function(){return app.utility.IsMacPlatform()?app.tl("Press the Return key to create a new tag."):app.tl("Press the Enter key to create a new tag.")}}())),this.subscriptions.push(this.placeholderText=ko.pureComputed(function(t){return function(){if(!t.canAddTags)return app.tl("Search tags");switch(t.mode){case"add":return app.tl("Add tag");case"edit":return app.tl("Rename tag");case"replace":return app.tl("Replace tag");case"merge":return app.tl("New tag name")}return app.tl("Unknown Mode")}}(this))),this.subscriptions.push(this.saveBtnText=ko.pureComputed(function(t){return function(){return t.isSubmitting()?app.tl("Saving changes"):"edit"===t.mode?app.tl("Save changes"):app.tl("Create new tag")}}(this))),"edit"!==this.mode&&(this.data=new s("tags.json",{pageSize:50,ItemClass:a,filter:{generateFilterParams:function(e){return function(){return t={filter:"all",skipSpecial:!0,q:e.searchTerm(),searchTerm:e.searchTerm(),projectIds:e.getProjectIdsForUrl(),getProjectData:!0,sort:"projectDateLastUsed",sortOrder:"desc",orderBy:"projectDateLastUsed",orderMode:"desc"}}}(this)},loadNow:!0,onLoad:function(t){return function(){var e;e=function(t){var e,n,i,s,a,o,r,p,d;for(p=[],i={},e=s=0,a=t.length;s<a;e=++s)d=t[e],o=d.projectId(),0!==parseInt(o)&&(r=d.projectName(),n=i[o],null==n&&(p.push({name:r,id:o,tags:[]}),n=p.length-1,i[o]=n),p[n].tags.push(d));return p},t.setFilteredTags(t.data.list()),t.tagsByProject(e(t.filteredTags())),t.isInitialLoadComplete(!0),app.FocusFirstInput("tagEditForm")}}(this)}))}return t.prototype.OnRenderedItem=function(){return this.debouncedUpdateTipped()},t.prototype.OnRendered=function(t){this.useTipped&&(this.targetElement=t[0].parentNode,null==this.tippedObj&&this.setUpTipped(),Tipped.show(this.target)),app.FocusFirstInput("tagEditForm")},t.prototype.OnSubmit=function(){var t;if(!this.canAddTags)return!1;if(!this.newTagName().length)return!1;switch(this.mode){case"add":case"replace":case"merge":if(this.isCreatingNewTag()){if(this.userMustChooseTagOpts(!1),"merge"===this.mode)return this.mergeTags({tag:this.newTagObj(),isNewTag:!0});this.createNewTag().then(function(t){return function(e){return t.UpdateTagsOnItem(e)}}(this))}else{if(1!==this.filteredTags().length||this.filteredTags()[0].name()!==this.newTagName())return void this.userMustChooseTagOpts(!0);if(t=this.filteredTags()[0],"merge"===this.mode)return this.mergeTags({tag:t.toJSON(),isNewTag:!1});this.UpdateTagsOnItem(t)}break;case"edit":this.editTag(this.newTagObj());break;default:throw new Error("Unknown mode"+ko.unwrap(this.mode))}return this.useTipped&&this.tippedObj.hide(),!1},t.prototype.OnClearInput=function(){this.deSelectAllTags(),this.menuIndexPos(-1)},t.prototype.OnKeyDownTagInput=function(){return this.canAddTags?this.OnKeyDownCanAddTag.apply(this,arguments):this.OnKeyDownCannotAddTags.apply(this,arguments)},t.prototype.OnKeyDownCanAddTag=function(t,e){var n,i;return n=this.filteredTags().length,13===(i=e.keyCode)||9===i?!(this.menuIndexPos()>=0&&this.menuIndexPos()<n)||(this.UpdateTagsOnItem(this.filteredTags()[this.menuIndexPos()]),Tipped.hideAll(),!1):38===e.keyCode?0!==n&&(this.menuIndexPos(this.menuIndexPos()-1),this.menuIndexPos()<=-1&&this.menuIndexPos(n-1),this.highlightTag(this.menuIndexPos()),!1):40===e.keyCode?0!==n&&(this.menuIndexPos(this.menuIndexPos()+1),this.menuIndexPos()>=n&&this.menuIndexPos(0),this.highlightTag(this.menuIndexPos()),!1):27===e.keyCode?(Tipped.hideAll(),!1):(this.menuIndexPos(-1),!0)},t.prototype.OnKeyDownCannotAddTags=function(t,e){var n,i;return n=this.filteredTags().length,13===(i=e.keyCode)||9===i?!(this.menuIndexPos()>=0&&this.menuIndexPos()<n)||(this.UpdateTagsOnItem(this.filteredTags()[this.menuIndexPos()]),!1):38===e.keyCode?0!==n&&(this.menuIndexPos(this.menuIndexPos()-1),this.menuIndexPos()<=-1&&this.menuIndexPos(n-1),this.highlightTag(this.menuIndexPos(),!1),!1):40===e.keyCode?0!==n&&(this.menuIndexPos(this.menuIndexPos()+1),this.menuIndexPos()>=n&&this.menuIndexPos(0),this.highlightTag(this.menuIndexPos(),!1),!1):27===e.keyCode?(Tipped.hideAll(),!1):(this.menuIndexPos(0),!0)},t.prototype.OnClickTag=function(t){return this.UpdateTagsOnItem(t),this.tippedObj.hide(),!1},t.prototype.OnClickColor=function(t,e){this.selColor(t)},t.prototype.OnClickLoadMore=function(){return this.data.LoadMore(),!1},t.prototype.OnClickToggleTopLevelTags=function(){return this.isShowingTopLevelTags(!this.isShowingTopLevelTags()),this.debouncedUpdateTipped(),!1},t.prototype.OnClickToggleTagLevel=function(){return this.isNewTagProjectSpecific(!this.isNewTagProjectSpecific())},t.prototype.setUpTipped=function(){var t,e,n;if(!this.target.classList.contains("tipped-exists"))return e=function(t){return function(e,n){var s,a,o,r;return n.classList.add("tipped-exists"),null!=(s=t.parent)&&null!=(a=s.options)&&(a.hideAfter=!1),"task"===t.type&&(n.classList.add("tipped-exists"),i(".task-row").removeClass("options-visible"),i(n).parents(".task-row").addClass("options-visible")),null!=(null!=(o=t.item)?o.displayMode:void 0)&&(t.orig_displayMode=t.item.displayMode()),null!=(null!=(r=t.item)?r.displayMode:void 0)&&"list"===t.item.displayMode()&&t.item.displayMode("list-quickset"),setTimeout(function(){return Tipped.refresh()},300)}}(this),t=function(t){return function(e,n){var s,a,o;return t.newTagName(""),null!=(s=t.parent)&&null!=(a=s.options)&&(a.hideAfter=300),null!=(null!=(o=t.item)?o.displayMode:void 0)&&null!=t.orig_displayMode&&"list-quickset"===t.item.displayMode()&&t.item.displayMode(t.orig_displayMode),null!=t.isShownObserver&&t.isShownObserver(!1),"task"===t.type&&i(".task-row").removeClass("options-visible"),ko.isWriteableObservable(t.selectedTags)&&t.selectedTags([]),Tipped.hideAll()}}(this),n={position:{target:"bottommiddle",tooltip:"topright"},skin:"light",showOn:"click",hideOn:!1,hideOnClickOutside:!0,hideOthers:!1,onShow:e,afterHide:t,detach:!1,padding:0},app.isMobile&&(n.hideAfter=0,n.showDelay=0,n.closeButton=!0,n.closeButtonSkin="light"),this.tippedObj=Tipped.create(i(this.target),this.targetElement,n)},t.prototype.highlightTag=function(t,e){var n;if(null==e&&(e=!0),null!=(n=this.filteredTags()[this.menuIndexPos()]))return this.deSelectAllTags(),n.isSelected(!0),e?this.newTagName(n.name()):void 0},t.prototype.debouncedUpdateTipped=app.utility.debounce(function(){return null!=t.target?Tipped.refresh(t.target):Tipped.refresh()},10),t.prototype.isItemNew=function(){return!(null!=ko.unwrap(this.item.id)&&ko.unwrap(this.item.id)>0)},t.prototype.deSelectAllTags=function(){var t,e,n,i,s;for(n=this.filteredTags(),i=[],t=0,e=n.length;t<e;t++)s=n[t],i.push(s.isSelected(!1));return i},t.prototype.getProjectIdsForUrl=function(){var t;return t=[0],this.canUseProjectTags()&&("merge"!==this.mode||this.areCrossProjectTagsSelected()?t.push(this.projectId()):t=t.concat(this.selectedTagsProjectIds())),app.utility.Uniq(t).toString()},t.prototype.UpdateTagsOnItem=function(t){var e,n,i,s,a;return console.assert(null!=this.item.tags),"merge"===this.mode?this.mergeTags({tag:t.toJSON(),isNewTag:!1}):(e=this.item.tags().map(function(t){return function(t){return t.id()}}()),e.indexOf(t.id())>-1?void 0:(null!=this.item.addTag&&this.item.addTag(t),n=1===this.selectedTags().length,s=this.item.tags,n?(i=s.indexOf(this.selectedTag()),s.splice(i,1,t)):(a=ko.unwrap(this.item.tags),a.push(t),a.sort(function(t,e){return t.name().localeCompare(e.name())}),s(a)),this.isItemNew()?void 0:this.persistTags()))},t.prototype.createNewTag=function(){var t;return this.newTagName().length>50?(app.flash.Error(app.tl("Error: Tags must be less than [_s] characters long","50")),n.resolve()):(t=new e(this.newTagObj()),t.save())},t.prototype.editTag=function(t){var e,n,i,s,a;if(i=t.name,e=t.color,s=t.projectId,console.assert(1===this.selectedTags().length),a=this.selectedTag(),a.id()>0)return n=parseInt(a.projectId(),10),s=parseInt(s,10),("function"==typeof a.count?a.count():void 0)>0&&s>0&&n!==s?app.api.get("tags/items.json?tag[id]="+a.id()+"&getProjectInfo=1").then(function(t){return function(n){var o,r,p;return o=n.response.items.filter(function(t){var e;return 0!==(e=parseInt(t.projectId,10))&&e!==s}),o.length?(p=app.tl("Confirm Change"),r=app.tl("By changing this to a project specific tag, [_s] items outside of the project will be untagged. Are you sure you want to change it?",o.length),app.modal.Show("confirm",{title:p,text:r,callback:function(n){return n.wasCancelled?void a.isSelected(!1):t.saveTagChanges({name:i,color:e,projectId:s})}})):t.saveTagChanges({name:i,color:e,projectId:s})}}(this)):this.saveTagChanges({name:i,color:e,projectId:s})},t.prototype.saveTagChanges=function(t){var e,n,i,s,a,o,r,p,d;i=t.name,e=t.color,r=t.projectId,p=this.selectedTag(),a=p.name(),s=p.color(),o=p.projectId(),null!=i&&p.name(i),null!=e&&p.color(e),null!=r&&p.projectId(r),n={tag:{id:ko.unwrap(p.id),name:ko.unwrap(p.name),color:ko.unwrap(p.color),projectId:ko.unwrap(p.projectId)}},this.isSubmitting(!0),d=app.prefixApi("tags/"+p.id()+".json","API_PREFIX_CF","API_PREFIX_CF"),app.api.put(d,n).then(function(t){return function(e){var i;if(t.isSubmitting(!1),"OK"===e.response.STATUS&&("projects"===app.currentRoute().page&&null!=t.item.id?app.projectInfo.update(t.id()):null!=app.currentRoute().projectId&&app.projectInfo.update(app.currentRoute().projectId),app.hybrid.store.commit("tag/record",n.tag),i={eventTime:new Date,itemType:"tag",itemId:p.id(),actionType:app.consts.ACTIONTYPE.UPDATED,subType:t.type+"-tag-updated",extraInfo:{tagData:n.tag}},"settings"!==t.type&&(i.extraInfo.taggedItemId=ko.unwrap(t.id)),ko.postbox.publish("allTWEvents",i),null!=t.tippedObj))return t.tippedObj.hide()}}(this)).catch(function(t){return function(e){return console.error(e),t.isSubmitting(!1),p.name(a),p.color(s),p.projectId(o)}}(this)).finally(function(t){return function(){if(null!=p.isSelected)return p.isSelected(!1)}}())},t.prototype.mergeTags=function(t){var e,n,i;null==t&&(t={}),console.assert(this.selectedTags().length>1),this.isSubmitting(!0),n=this.selectedTags().map(function(t){return t.id()}),i="tags/merge.json",e={ids:n.toString()},t.isNewTag?e.newTag=t.tag:e.id=t.tag.id,app.api.put(i,e).then(function(t){return function(e){if(ko.postbox.publish("allTWEvents",{eventTime:new Date,itemType:"tag",actionType:app.consts.ACTIONTYPE.UPDATED,subType:"tags-merged",extraInfo:{mergedTagIds:n}}),null!=t.tippedObj)return t.tippedObj.hide()}}(this)).finally(function(t){return function(){return t.isSubmitting(!1)}}(this))},t.prototype.persistTags=function(){var t,e,n,i;if(this.autosave)return n=this.item.tags,e=n().map(function(t){return parseInt(t.id(),10)}).toString(),n().forEach(function(t){if("hubspot"===t.name().trim().toLowerCase())return app.flash.Error(app.tl("Sorry, [_s] is a reserved tag name","'Hubspot'")),!1}),i=this.type+"/"+ko.unwrap(this.id)+"/tags.json?getTags=true&replaceExistingTags=true",t={tagIds:e},app.api.put(i,t).then(function(t){return function(e){var i,s,a,o,r,p,d,c;if("OK"===e.response.STATUS&&(o=e.response.tags,i=null!=(r=e.response.linkedCardId)?r:0,s=null!=(p=e.response.linkedColumnId)?p:0,a=null!=(d=e.response.linkedColumnName)?d:"",n(app.tags.getAll(o)),app.ko.postbox.publish("allTWEvents",{eventTime:new Date,projectId:(null!=(c=app.currentRoute().project)?c.id():void 0)||0,itemId:t.id(),itemType:"tags",subType:t.type,tags:o,extraInfo:{data:{hasTags:!0,cardId:i,columnId:s,columnName:a}}}),"project"===t.type))return app.projectInfo.update(t.id())}}(this))},t.prototype.setFilteredTags=function(t){var e,n;e=this.item.tags().map(function(t){return function(t){return parseInt(t.id(),10)}}()),n=ko.utils.arrayFilter(t,function(t){return function(t){return-1===e.indexOf(t.id())}}()),n.sort(function(t){return function(t,e){return t.projectId()<=e.projectId()?1:-1}}()),this.filteredTags(n)},t.prototype.isProjectLevelTagSelected=function(){return this.selectedTagsProjectIds().some(function(t){return t>0})},t.prototype.dispose=function(){this.useTipped&&(this.target.classList.remove("tipped-exists"),"string"==typeof this.target?Tipped.remove("#"+this.target):Tipped.remove(this.target)),this.subscriptions.forEach(function(t){return t.dispose()}),this.useTipped&&(this.tippedObj.remove(),this.tippedObj=null)},t}(),{viewModel:r,template:t}}.apply(e,s))&&(t.exports=a)}).call(e,n(245))},4332:function(t,e,n){var i,s,a=function(t,e){return function(){return t.apply(e,arguments)}},o=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;i=[n(1705)],void 0!==(s=function(t){var e;return e=function(t){function e(t){null==t&&(t={}),this.load=a(this.load,this),this.tags=ko.observableArray([]),this.type=t.type,this.id=t.id,e.__super__.constructor.call(this,{item:{id:this.id,tags:this.tags},type:this.type,canEdit:!1,enabled:!0,canAddTags:!1}),this.load()}return o(e,t),e.prototype.load=function(){var t;return t=this.type+"/"+ko.unwrap(this.id)+"/tags.json",app.api.get(t).then(function(t){return function(e){return t.tags(app.tags.getAll(e.response.tags))}}(this))},e}(t.viewModel),{viewModel:e,template:t.template}}.apply(e,i))&&(t.exports=s)},4333:function(t,e,n){var i,s,a=function(t,e){return function(){return t.apply(e,arguments)}};i=[n(3211)],void 0!==(s=function(t){var e;return e=function(){function t(t){var e,n,i,s;null==t&&(t={}),this.dispose=a(this.dispose,this),null!=t.item&&null!=t.item.tags&&console.assert(ko.isObservable(t.item.tags)),this.subscriptions=[],this.item={tags:(null!=(e=t.item)?e.tags:void 0)||ko.observableArray([])},this.projectId=app.utility.EnsureObservable(null!=(n=t.projectId)?n:0),this.enabled=t.enabled,this.canAddTags=null==(i=t.canAddTags)||i,this.label=t.label||app.tl("Select Tag"),this.allowSelectingUnlimitedNumber=null!=(s=t.allowSelectingUnlimitedNumber)&&s,this.tagNames=ko.pureComputed(function(t){return function(){return t.item.tags().map(function(t){return t.name()}).join(",")}}(this)),this.subscriptions.push(this.tagNames),this.tagIds=ko.pureComputed(function(t){return function(){return t.item.tags().map(function(t){return t.id()}).join(",")}}(this)),this.subscriptions.push(this.tagIds),t.listener&&this.subscriptions.push(this.tagIds.subscribe(t.listener))}return t.prototype.dispose=function(){this.subscriptions.forEach(function(t){return t.dispose()})},t}(),{viewModel:e,template:t}}.apply(e,i))&&(t.exports=s)},4335:function(t,e,n){var i,s,a=function(t,e){return function(){return t.apply(e,arguments)}},o=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;i=[n(1705),n(3213)],void 0!==(s=function(t,e){var n;return n=function(t){function e(t){var n;null==t&&(t={}),this.load=a(this.load,this),this.loadSpecialTags=a(this.loadSpecialTags,this),this.tags=null!=t.tags?t.tags:ko.observableArray([]),this.type=t.type,this.id=t.id,this.useWhiteIcon=null!=(n=t.useWhiteIcon)&&n,null==this.subscriptions&&(this.subscriptions=[]),e.__super__.constructor.call(this,{item:{id:this.id,tags:this.tags},type:this.type,canEdit:!1,enabled:!0,canAddTags:!1}),e.specialTagsHaveLoaded||this.loadSpecialTags(),this.specialTagsView=ko.pureComputed(function(t){return function(){var n;return n=t.tags().map(function(t){return t.name()}),e.specialTags().map(function(t){return{enabled:-1!==n.indexOf(t.name()),tag:t}})}}(this)),this.subscriptions.push(this.specialTagsView),null==t.tags&&this.load()}return o(e,t),e.specialTags=ko.observableArray(),e.specialTagsHaveLoaded=!1,e.prototype.loadSpecialTags=function(){var t;return e.specialTagsHaveLoaded=!0,t="tags/special.json",app.api.get(t).then(function(t){return function(t){return e.specialTags(app.tags.getAll(t.response.tags))}}())},e.prototype.load=function(){var t;return t=this.type+"/"+ko.unwrap(this.id)+"/tags.json",app.api.get(t).then(function(t){return function(e){return t.tags(app.tags.getAll(e.response.tags))}}(this))},e.prototype.dispose=function(){return this.subscriptions.forEach(function(t){return t.dispose()})},e}(t.viewModel),{viewModel:n,template:e}}.apply(e,i))&&(t.exports=s)}});
//# sourceMappingURL=tags.cb75d554ae47e98d4508.js.map